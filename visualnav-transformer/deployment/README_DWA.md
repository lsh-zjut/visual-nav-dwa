# DWA控制器使用说明

本文档说明如何使用新的DWA（Dynamic Window Approach）控制器替代原来的PD控制器。

## 概述

`dwa_controller.py`是一个基于DWA算法的局部路径规划控制器，它接收来自`navigate.py`发布的waypoint，并根据这些waypoint计算最优的线速度和角速度，使机器人能够安全地到达目标点。

## 主要特点

- 使用动态窗口法（DWA）进行局部路径规划
- 考虑机器人的运动约束和速度限制
- 综合评价函数考虑目标距离、障碍物距离和速度因素
- 与现有代码结构保持兼容，可以直接替代PD控制器

## 使用方法

### 基本使用

1. 确保`navigate.py`正常运行并发布waypoint到`/waypoint`话题

2. 运行DWA控制器：

```bash
python dwa_controller.py
```

3. 停止原来的PD控制器（如果正在运行）

### 配置参数

DWA控制器的主要参数可以在代码中修改：

- `V_RESOLUTION`：线速度分辨率
- `W_RESOLUTION`：角速度分辨率
- `PREDICT_TIME`：预测时间
- `sim_time_step`：仿真时间步长
- `GOAL_WEIGHT`、`DISTANCE_WEIGHT`、`VELOCITY_WEIGHT`：评价函数权重

### 注意事项

1. 当前版本是一个基础实现，简化了一些功能：
   - 机器人状态（位置、方向、速度）使用了默认值
   - 障碍物信息为空列表

2. 在实际应用中，应该：
   - 订阅里程计话题以获取机器人的真实状态
   - 订阅激光雷达话题以获取障碍物信息
   - 根据实际机器人性能调整DWA参数

## 与原PD控制器的区别

- PD控制器直接根据waypoint计算控制量，没有考虑障碍物和运动约束
- DWA控制器通过预测轨迹、评价轨迹，选择最优的速度命令，能够更好地避开障碍物
- DWA控制器允许机器人后退运动，增加了机动性

## 扩展建议

1. 添加里程计和激光雷达数据处理
2. 实现更复杂的障碍物避障算法
3. 根据实际机器人模型调整运动模型参数
4. 动态调整DWA参数以适应不同环境